{% extends "base.html" %}
{% block content %}
<div class="container">
  <aside class="sidebar">
    <h3>Your profile</h3>
    {% if current_user.is_authenticated %}
      <p><strong>{{ current_user.name or current_user.email }}</strong></p>
      <p>Crop: {{ current_user.primary_crop or "—" }}</p>
      <p>Region: {{ current_user.region or "—" }}</p>
      <p>Lang: {{ current_user.preferred_language or "en" }}</p>
      <a class="btn" href="{{ url_for('profile') }}">Edit profile</a>
    {% else %}
      <p><a href="{{ url_for('login') }}">Login</a> to save chat & see profile.</p>
    {% endif %}
    {% if recent_users %}
      <hr>
      <h4>Recent users (admin)</h4>
      <ul class="user-list">
        {% for u in recent_users %}
          <li>
            <a href="{{ url_for('admin_view_user', user_id=u.id) }}">
              {{ u.email }} - {{ u.name or '—' }}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
  </aside>
  <section class="chat-panel">
    <div id="messages" class="messages" aria-live="polite"></div>
    <form id="chatForm" class="chat-form" onsubmit="return false;">
      <input id="msg" aria-label="Type your question" placeholder="Ask about crops, pests or soil (e.g. 'best soil for cotton')" autocomplete="off">
      <button id="sendBtn" type="button" class="btn">Send</button>
    </form>

    <!-- IMAGE ANALYSIS FEATURE -->
    <form id="image-form" enctype="multipart/form-data" style="margin-top:24px;">
      <label><b>Analyze plant/leaf image:</b></label><br>
      <input type="file" id="image-input" name="image" accept="image/*" required>
      <button type="submit" class="btn">Analyze Image</button>
    </form>
    <div id="image-result" style="margin-top:10px;color:#2563eb"></div>
    <!-- End IMAGE ANALYSIS FEATURE -->

  </section>
</div>
{% endblock %}

